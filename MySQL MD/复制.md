#### 使用 docker-compose 部署主从集群，用于测试

docker-compose.yml 文件

```
version: '3.1'

services:
  master:
    image: mysql:5.7.34
    command: --default-authentication-plugin=mysql_native_password
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: MySQL5.6
    volumes:
       - /data/mysql/master/data:/var/lib/mysql
       - /data/mysql/master/conf:/etc/mysql/conf.d
    ports:
      - "3306:3306"

  slave:
    image: mysql:5.7.34
    command: --default-authentication-plugin=mysql_native_password
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: MySQL5.6
    volumes:
       - /data/mysql/slave/data:/var/lib/mysql
       - /data/mysql/slave/conf:/etc/mysql/conf.d
    ports:
      - "3308:3306"
```

master 自定义配置文件 custom.cnf

```
[mysqld]
server-id=1
log_bin=mysqld-bin
binlog_format=row
gtid_mode=on
enforce_gtid_consistency=on
```

slave 自定义配置文件 custom.cnf

```
[mysqld]
server-id=2
log_bin=mysqld-bin
binlog_format=row
gtid_mode=on
enforce_gtid_consistency=on
```

启动 master

```
docker-compose up -d master
```

将 master 的数据文件拷贝到 slave 数据文件目录中

> 要删除 auto.cnf 文件夹，改文件保留了实例 UUID，不能相同，slave 启动时会自动创建

```
cp -R master/data/* slave/data/
chown -R polkitd.input slave/data
```

启动 slave

```
docker-compose up -d slave
```

登录 slave 指定 master

```
mysql> change master to master_host='192.168.40.202',master_user='root',master_password='MySQL5.6',master_auto_position=1;
mysql> start slave;
mysql> show slave status;
```

