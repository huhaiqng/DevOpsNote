### 表

优化表，释放空间

```
OPTIMIZE TABLE tbl_name;
```

将表改为压缩模式

```
ALTER TABLE tbl_name ROW_FORMAT = COMPRESSED, ALGORITHM=INPLACE, LOCK=NONE;
```

查看表的状态

```
SHOW TABLE STATUS FROM sbtest LIKE 'sbtest1'\G
```

优化表

```
OPTIMIZE TABLE tbl_name;
```

重命名表

```
ALTER TABLE old_tbl_name RENAME TO new_tbl_name, ALGORITHM=INPLACE, LOCK=NONE;
```

##### 索引

创建索引

```
ALTER TABLE tbl_name ADD INDEX name (col_list);
```

删除索引

```
ALTER TABLE tbl_name DROP INDEX name;
```

查看表的索引

```
SHOW INDEX FROM tbl_name;
```



##### 主键

添加主键

```
ALTER TABLE tbl_name ADD PRIMARY KEY (column), ALGORITHM=INPLACE, LOCK=NONE;
```

删除主键

```
ALTER TABLE tbl_name DROP PRIMARY KEY, ALGORITHM=COPY;
```

删除主键并添加另一个

```
ALTER TABLE tbl_name DROP PRIMARY KEY, ADD PRIMARY KEY (column), ALGORITHM=INPLACE, LOCK=NONE;
```

##### 列

新增列

```
ALTER TABLE tbl_name ADD COLUMN column_name column_definition, ALGORITHM=INPLACE, LOCK=NONE;
```

删除列

```
ALTER TABLE tbl_name DROP COLUMN column_name, ALGORITHM=INPLACE, LOCK=NONE;
```

重命名列

```
ALTER TABLE tbl CHANGE old_col_name new_col_name data_type, ALGORITHM=INPLACE, LOCK=NONE;
```

更改列的类型

```
ALTER TABLE tbl_name CHANGE c1 c1 BIGINT, ALGORITHM=COPY;
```

更改列的大小

```
ALTER TABLE tbl_name CHANGE COLUMN c1 c1 VARCHAR(255), ALGORITHM=INPLACE, LOCK=NONE;
```

### 复制

清理 slave 的 master 的配置

```
reset slave all;
```

清理二进制日志文件和清空 gtid

```
reset master;
```

启动组复制

```
START GROUP_REPLICATION
```

停止组复制

```
STOP GROUP_REPLICATION
```

显示从节点

```
SHOW SLAVE HOSTS;
```

查看组复制当前成员的状态

```
select * from performance_schema.replication_group_member_stats\G
```

### 管理

查看 MySQL 的线程

```
top -H -p <mysql进程ID>
```

查看 MySQL 系统线程和 MySQL 线程的对应关系

```
select * from performance_schema.threads where THREAD_OS_ID=<mysql线程id>\G
select * from information_schema.processlist where ID=<PROCESSLIST_ID>\G
```

查看正在运行的事务

```
select * from information_schema.innodb_trx\G
```

显示用户的权限

```
SHOW GRANTS FOR 'jeffrey'@'localhost';
```

显示表的索引

```
SHOW INDEX FROM sbtest.sbtest1\G
```

将全部数据导入到另一实例

```
mysqldump -u root -pMySQL5.7 \
--all-databases --triggers --routines --events \
--single-transaction --quick | \
mysql -h 192.168.1.226 -u root -pMySQL5.7
```

删除二进制日志

```
FLUSH LOGS;
PURGE BINARY LOGS TO 'mysql-bin.00000N';
```

撤销用户权限

```
revoke all on *.* from 'root'@'%';
```

##### 状态查看

查看磁盘临时表的数量

```
show global status like 'Created_tmp_disk_tables';
```

查看服务器启动以来最大的连接数及发生的时间点

```
 show global status like 'Max_used_connections%';
```

查看 full join 全表扫描的数量

```
show global status like 'Select_full_join';
```

查看全表扫描的数量

```
show global status like 'Select_scan';
```

查看线程

```
show global status like 'Threads%';
```

将表加上只读锁

```
FLUSH TABLES WITH READ LOCK;
```

将表解锁

```
UNLOCK TABLES;
```

